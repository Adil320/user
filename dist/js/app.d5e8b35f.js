(function(){"use strict";var e={9376:function(e,t,s){var n=s(8935),o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("User")],1)},i=[],a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"user"},[s("button",{staticClass:"item",on:{click:e.openSocket}},[e._v("Open Socket")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.inputValue,expression:"inputValue"}],staticClass:"item",attrs:{type:"text"},domProps:{value:e.inputValue},on:{input:function(t){t.target.composing||(e.inputValue=t.target.value)}}}),s("button",{staticClass:"item",on:{click:e.sendMessage}},[e._v("Send message")]),s("div",{class:[e.showMessage?"visible":"hidden","message"]},[s("div",{staticClass:"date"},[e._v(e._s(e.receiptTime))]),s("div",[e._v(e._s(e.message))])])])},r=[],c=s(6166),u=s.n(c);async function l(e,t){const s={"Content-Type":"application/json"};try{let n=await u().post(e,t,{headers:s});if(200===n.status)return n}catch(n){console.log(n)}}class p{constructor(e){this.url=e,this.socket=new WebSocket(e)}send(e){this.socket.send(e)}onmessage(e){this.socket.onmessage=t=>{if(t)return e(JSON.parse(t.data))}}close(){this.socket.onclose=e=>{e.wasClean?console.log(`[close] Соединение закрыто чисто, код=${e.code} причина=${e.reason}`):console.log("[close] Соединение прервано")}}open(e){this.socket.onopen=e=>{}}}var f=s(2723),d=s.n(f),h={name:"User",data:()=>({ws:null,accessToken:"",inputValue:"",showMessage:"",message:"",receiptTime:""}),methods:{handleType(e){let{type:t,ok:s}=e;"response"===t&&s?this.createToastify("сервис по WebSocket",3e3,"info"):"inbox"===t?this.createToastify("Поступило новое сообщение (Открыть)",5e3,"info",e.type):s||this.createToastify("Произошла ошибка при работе с сокетом",3e3,"error")},closeSocket(){this.ws.close()},openSocket(){let e=JSON.stringify({id:1,access_token:this.accessToken});this.ws.send(e),this.ws.onmessage(this.handleType)},async sendMessage(){let e={message:this.inputValue,recipient:"Wpt9X9N5t8K7",subject:"test"},t=await l("noty/api/private/putInboxMessage",e);t.data.ok&&this.createToastify("Сообщение отправлено",3e3,"sucess")},async getLastMessage(){let e={access_token:this.accessToken,unread_only:"false"},t=await l("noty/api/v1/getInboxMessages",e);if(t)return t},async getToken(){let e={credential:"79191234567",password:"test"},t=await l("auth-back/api/v2/login",e);t?this.accessToken=t.data.accessToken:this.createToastify("Ошибка на сервере при получении токена",3e3,"error")},createToastify(e,t,s,n){let o={info:"#d1e635",sucess:"#90e33d",error:"#e63737"};d()({text:e,close:!0,duration:t,stopOnFocus:!1,style:{background:o[s]||"#d1e635",position:"absolute",right:"30px",top:"0px",padding:"5px",width:"300px"},onClick:async()=>{if(n&&"inbox"===n){let e=await this.getLastMessage();if(e){let{msg:t,dt:s}=e?.data?.items[0];this.message=t,this.receiptTime=this.dateFormat(s),this.showMessage=!0,this.createToastify("Сообщение успешно загружено",2e3,"sucess")}}}}).showToast()},dateFormat(e){let t=new Date(e);return`${t.toLocaleDateString("ru")}  ${t.getHours()+":"+t.getMinutes()}`}},mounted(){this.getToken()},created(){this.ws=new p("wss://charmium.ru/noty/notifications"),this.ws.open(this.createToastify("Соединение c web sockets установленно",2e3,"info")),this.ws.close()}},g=h,v=s(1001),m=(0,v.Z)(g,a,r,!1,null,null,null),w=m.exports,y={name:"App",components:{User:w}},k=y,b=(0,v.Z)(k,o,i,!1,null,null,null),T=b.exports;n.Z.config.productionTip=!0,new n.Z({render:e=>e(T)}).$mount("#app")}},t={};function s(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,s),i.exports}s.m=e,function(){var e=[];s.O=function(t,n,o,i){if(!n){var a=1/0;for(l=0;l<e.length;l++){n=e[l][0],o=e[l][1],i=e[l][2];for(var r=!0,c=0;c<n.length;c++)(!1&i||a>=i)&&Object.keys(s.O).every((function(e){return s.O[e](n[c])}))?n.splice(c--,1):(r=!1,i<a&&(a=i));if(r){e.splice(l--,1);var u=o();void 0!==u&&(t=u)}}return t}i=i||0;for(var l=e.length;l>0&&e[l-1][2]>i;l--)e[l]=e[l-1];e[l]=[n,o,i]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,i,a=n[0],r=n[1],c=n[2],u=0;if(a.some((function(t){return 0!==e[t]}))){for(o in r)s.o(r,o)&&(s.m[o]=r[o]);if(c)var l=c(s)}for(t&&t(n);u<a.length;u++)i=a[u],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(l)},n=self["webpackChunkuser"]=self["webpackChunkuser"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=s.O(void 0,[998],(function(){return s(9376)}));n=s.O(n)})();
//# sourceMappingURL=app.d5e8b35f.js.map