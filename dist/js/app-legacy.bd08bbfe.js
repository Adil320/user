(function(){"use strict";var e={9376:function(e,t,n){n(6992),n(8674),n(9601),n(7727);var r=n(9567),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("User")],1)},o=[],a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"user"},[n("button",{staticClass:"item",on:{click:e.openSocket}},[e._v("Open Socket")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.inputValue,expression:"inputValue"}],staticClass:"item",attrs:{type:"text"},domProps:{value:e.inputValue},on:{input:function(t){t.target.composing||(e.inputValue=t.target.value)}}}),n("button",{staticClass:"item",on:{click:e.sendMessage}},[e._v("Send message")]),n("div",{class:[e.showMessage?"visible":"hidden","message"]},[n("div",{staticClass:"date"},[e._v(e._s(e.receiptTime))]),n("div",[e._v(e._s(e.message))])])])},i=[],c=n(6198),u=(n(8975),n(8862),n(2222),n(6166)),l=n.n(u);function f(e,t){return p.apply(this,arguments)}function p(){return p=(0,c.Z)(regeneratorRuntime.mark((function e(t,n){var r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={"Content-Type":"application/json"},e.prev=1,e.next=4,l().post(t,n,{headers:r});case 4:if(s=e.sent,200!==s.status){e.next=7;break}return e.abrupt("return",s);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](1),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])}))),p.apply(this,arguments)}var d=n(6133),h=n(2751),v=function(){function e(t){(0,d.Z)(this,e),this.url=t,this.socket=new WebSocket(t)}return(0,h.Z)(e,[{key:"send",value:function(e){this.socket.send(e)}},{key:"onmessage",value:function(e){this.socket.onmessage=function(t){if(t)return e(JSON.parse(t.data))}}},{key:"close",value:function(){this.socket.onclose=function(e){e.wasClean?console.log("[close] Соединение закрыто чисто, код=".concat(e.code," причина=").concat(e.reason)):console.log("[close] Соединение прервано")}}},{key:"open",value:function(e){this.socket.onopen=function(e){}}}]),e}(),g=n(2723),m=n.n(g),k={name:"User",data:function(){return{ws:null,accessToken:"",inputValue:"",showMessage:"",message:"",receiptTime:""}},methods:{handleType:function(e){var t=e.type,n=e.ok;"response"===t&&n?this.createToastify("сервис по WebSocket",3e3,"info"):"inbox"===t?this.createToastify("Поступило новое сообщение (Открыть)",5e3,"info",e.type):n||this.createToastify("Произошла ошибка при работе с сокетом",3e3,"error")},closeSocket:function(){this.ws.close()},openSocket:function(){var e=JSON.stringify({id:1,access_token:this.accessToken});this.ws.send(e),this.ws.onmessage(this.handleType)},sendMessage:function(){var e=this;return(0,c.Z)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={message:e.inputValue,recipient:"Wpt9X9N5t8K7",subject:"test"},t.next=3,f("noty/api/private/putInboxMessage",n);case 3:r=t.sent,r.data.ok&&e.createToastify("Сообщение отправлено",3e3,"sucess");case 5:case"end":return t.stop()}}),t)})))()},getLastMessage:function(){var e=this;return(0,c.Z)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={access_token:e.accessToken,unread_only:"false"},t.next=3,f("noty/api/v1/getInboxMessages",n);case 3:if(r=t.sent,!r){t.next=6;break}return t.abrupt("return",r);case 6:case"end":return t.stop()}}),t)})))()},getToken:function(){var e=this;return(0,c.Z)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={credential:"79191234567",password:"test"},t.next=3,f("auth-back/api/v2/login",n);case 3:r=t.sent,r?e.accessToken=r.data.accessToken:e.createToastify("Ошибка на сервере при получении токена",3e3,"error");case 5:case"end":return t.stop()}}),t)})))()},createToastify:function(e,t,n,r){var s=this,o={info:"#d1e635",sucess:"#90e33d",error:"#e63737"};m()({text:e,close:!0,duration:t,stopOnFocus:!1,style:{background:o[n]||"#d1e635",position:"absolute",right:"30px",top:"0px",padding:"5px",width:"300px"},onClick:function(){var e=(0,c.Z)(regeneratorRuntime.mark((function e(){var t,n,o,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!r||"inbox"!==r){e.next=5;break}return e.next=3,s.getLastMessage();case 3:t=e.sent,t&&(o=null===t||void 0===t||null===(n=t.data)||void 0===n?void 0:n.items[0],a=o.msg,i=o.dt,s.message=a,s.receiptTime=s.dateFormat(i),s.showMessage=!0,s.createToastify("Сообщение успешно загружено",2e3,"sucess"));case 5:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()}).showToast()},dateFormat:function(e){var t=new Date(e);return"".concat(t.toLocaleDateString("ru"),"  ").concat(t.getHours()+":"+t.getMinutes())}},mounted:function(){this.getToken()},created:function(){this.ws=new v("wss://charmium.ru/noty/notifications"),this.ws.open(this.createToastify("Соединение c web sockets установленно",2e3,"info")),this.ws.close()}},w=k,y=n(1001),b=(0,y.Z)(w,a,i,!1,null,null,null),x=b.exports,T={name:"App",components:{User:x}},O=T,_=(0,y.Z)(O,s,o,!1,null,null,null),M=_.exports;r.Z.config.productionTip=!0,new r.Z({render:function(e){return e(M)}}).$mount("#app")}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var o=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}n.m=e,function(){var e=[];n.O=function(t,r,s,o){if(!r){var a=1/0;for(l=0;l<e.length;l++){r=e[l][0],s=e[l][1],o=e[l][2];for(var i=!0,c=0;c<r.length;c++)(!1&o||a>=o)&&Object.keys(n.O).every((function(e){return n.O[e](r[c])}))?r.splice(c--,1):(i=!1,o<a&&(a=o));if(i){e.splice(l--,1);var u=s();void 0!==u&&(t=u)}}return t}o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[r,s,o]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,r){var s,o,a=r[0],i=r[1],c=r[2],u=0;if(a.some((function(t){return 0!==e[t]}))){for(s in i)n.o(i,s)&&(n.m[s]=i[s]);if(c)var l=c(n)}for(t&&t(r);u<a.length;u++)o=a[u],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(l)},r=self["webpackChunkuser"]=self["webpackChunkuser"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=n.O(void 0,[998],(function(){return n(9376)}));r=n.O(r)})();
//# sourceMappingURL=app-legacy.bd08bbfe.js.map